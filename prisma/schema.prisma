// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client"
  output          = "../src/generated/prisma"
  moduleFormat    = "cjs"
  previewFeatures = ["strictUndefinedChecks"]
}

datasource db {
  provider = "mysql"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(REPRESENTANTE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fairRepresentations FairRepresentative[]
  sessions            Session[]

  @@map("User")
}

enum UserRole {
  ADMIN // Administrador
  MERCADEO // Mercadeo
  REPRESENTANTE // Representantes
}

model Session {
  id           String   @id @default(uuid())
  userId       String
  token        String   @unique @db.VarChar(255)
  refreshToken String   @unique
  createdAt    DateTime @default(now())
  expiresAt    DateTime

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@map("Session")
}

model Fair {
  id              String   @id @default(uuid())
  name            String
  startDate       DateTime
  endDate         DateTime
  country         String
  city            String?
  logoUrl         String   @db.VarChar(255)
  standNumber     String
  areaM2          Float
  totalInvestment Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  representatives  FairRepresentative[]
  contacts         Contact[]
  activities       ParallelActivity[]
  competitors      FairCompetitor[]
  tendencies       Tendency[]
  dafo             DafoAnalysis[]
  evaluation       FairEvaluation[]
  fairAchievement  FairAchievement[]
  improvementAreas ImprovementArea[]
  evidences        FairEvidence[]

  @@map("Fair")
}

model FairRepresentative {
  id       String @id @default(uuid())
  fairId   String
  userId   String
  fullName String

  fair Fair @relation(fields: [fairId], references: [id])
  user User @relation(fields: [userId], references: [id])

  contacts         Contact[]
  dafo             DafoAnalysis[]
  competitors      FairCompetitor[]
  evaluations      FairEvaluation[]
  achievements     FairAchievement[]
  improvementAreas ImprovementArea[]
  evidences        FairEvidence[]

  @@unique([fairId, userId])
  @@index([fairId])
  @@index([userId])
  @@map("FairRepresentative")
}

model Contact {
  id                 String    @id @default(uuid())
  fairId             String
  name               String
  email              String
  phone              String
  profileId          String
  otherProfile       String?
  company            String?
  companyNit         String?
  country            String
  city               String?
  estimatedPotential Potential
  createdById        String
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  fair      Fair               @relation(fields: [fairId], references: [id])
  profile   ContactProfile     @relation(fields: [profileId], references: [id])
  createdBy FairRepresentative @relation(fields: [createdById], references: [id])

  sale Sale?

  @@index([createdById])
  @@index([fairId])
  @@index([profileId])
  @@map("Contact")
}

enum Potential {
  BAJO
  MEDIO
  ALTO
}

model ContactProfile {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text

  contacts Contact[]

  @@map("ContactProfile")
}

model Sale {
  id        String @id @default(uuid())
  contactId String @unique
  amount    Amount

  contact Contact @relation(fields: [contactId], references: [id])

  @@map("Sale")
}

enum Amount {
  BAJA // 1M - 7M
  MEDIO // 7M - 20M
  ALTA // 20M - 50M
  SUPERIOR // +50M
}

model ParallelActivity {
  id          String       @id @default(uuid())
  fairId      String
  type        ActivityType
  description String       @db.Text
  attendees   Int?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  fair Fair @relation(fields: [fairId], references: [id])

  @@index([fairId])
  @@map("ParallelActivity")
}

enum ActivityType {
  CHARLA_TECNICA
  RUEDA_DE_NEGOCIOS
  OTRO
}

model DafoAnalysis {
  id               String   @id @default(uuid())
  fairId           String
  representativeId String
  type             DafoType
  description      String   @db.Text

  fair           Fair               @relation(fields: [fairId], references: [id])
  representative FairRepresentative @relation(fields: [representativeId], references: [id])

  @@index([fairId])
  @@index([representativeId])
  @@map("DafoAnalysis")
}

enum DafoType {
  DEBILIDAD
  AMENAZA
  FORTALEZA
  OPORTUNIDAD
}

model FairCompetitor {
  id               String   @id @default(uuid())
  fairId           String
  representativeId String
  company          String
  country          String
  city             String?
  featuredProducts String   @db.Text
  strengths        String   @db.Text
  weaknesses       String   @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  fair           Fair               @relation(fields: [fairId], references: [id])
  representative FairRepresentative @relation(fields: [representativeId], references: [id])

  @@index([fairId])
  @@index([representativeId])
  @@map("FairCompetitor")
}

model Tendency {
  id        String   @id @default(uuid())
  fairId    String
  title     String
  details   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fair Fair @relation(fields: [fairId], references: [id])

  @@index([fairId])
  @@map("Tendency")
}

model FairEvaluation {
  id               String   @id @default(uuid())
  fairId           String
  representativeId String
  score            Int
  explanation      String   @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  fair           Fair               @relation(fields: [fairId], references: [id])
  representative FairRepresentative @relation(fields: [representativeId], references: [id])

  @@unique([fairId, representativeId])
  @@index([representativeId])
  @@map("FairEvaluation")
}

model FairAchievement {
  id               String   @id @default(uuid())
  fairId           String
  representativeId String
  content          String   @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  fair           Fair               @relation(fields: [fairId], references: [id])
  representative FairRepresentative @relation(fields: [representativeId], references: [id])

  @@index([fairId])
  @@index([representativeId])
  @@map("FairAchievement")
}

model ImprovementArea {
  id               String   @id @default(uuid())
  fairId           String
  representativeId String
  content          String   @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  fair           Fair               @relation(fields: [fairId], references: [id])
  representative FairRepresentative @relation(fields: [representativeId], references: [id])

  @@index([fairId])
  @@index([representativeId])
  @@map("ImprovementArea")
}

model FairEvidence {
  id               String  @id @default(uuid())
  fairId           String
  representativeId String
  url              String  @db.VarChar(255)
  description      String? @db.Text

  fair           Fair               @relation(fields: [fairId], references: [id])
  representative FairRepresentative @relation(fields: [representativeId], references: [id])

  @@index([fairId])
  @@index([representativeId])
  @@map("FairEvidence")
}
